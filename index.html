<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sanic the Porcupine – Retro Hard Edition</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .wrapper {
      text-align: center;
    }

    h1 {
      margin-bottom: 6px;
      font-size: 22px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    p {
      margin-bottom: 8px;
      font-size: 13px;
      color: #9ca3af;
    }

    #game {
      border: 4px solid #111827;
      border-radius: 6px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      background: #1d4ed8;
      box-shadow: 0 0 24px rgba(15, 23, 42, 0.8);
      display: block;
      margin: 0 auto;
    }

    #hud {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: #9ca3af;
      max-width: 512px;
    }

    #score {
      font-weight: 600;
      color: #e5e7eb;
    }

    #lives {
      font-weight: 600;
      color: #e5e7eb;
    }

    #status {
      min-height: 18px;
      margin-top: 4px;
      font-size: 12px;
      color: #fbbf24;
    }

    .btn {
      border: none;
      background: #4f46e5;
      color: #e5e7eb;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(79, 70, 229, 0.7);
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .btn:hover {
      background: #6366f1;
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 0 4px rgba(79, 70, 229, 0.7);
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Sanic the Porcupine</h1>
    <p>Move with <strong>A / D</strong>, jump with <strong>Space</strong> or <strong>↑</strong>. Stomp enemies. Avoid touching them from the side.</p>

    <canvas id="game" width="512" height="288"></canvas>

    <div id="hud">
      <div>Score: <span id="score">0</span></div>
      <div>Lives: <span id="lives">3</span></div>
      <button id="restart" class="btn">Restart</button>
    </div>
    <div id="status">Press A / D / Space / ↑ to start.</div>
  </div>

  <script>
    (function () {
      "use strict";

      var canvas = document.getElementById("game");
      var ctx = canvas.getContext("2d");

      var scoreEl = document.getElementById("score");
      var livesEl = document.getElementById("lives");
      var restartBtn = document.getElementById("restart");
      var statusEl = document.getElementById("status");

      var WIDTH = canvas.width;
      var HEIGHT = canvas.height;

      function pix(n) {
        return Math.round(n);
      }

      var GRAVITY = 900;
      var MOVE_SPEED = 220;
      var JUMP_FORCE = 400;

      var groundHeight = 40;

      var keys = {
        left: false,
        right: false,
        jump: false
      };

      var running = false;
      var gameOver = false;
      var lastTime = 0;
      var score = 0;
      var lives = 3;

      var cameraX = 0;

      var player = {
        x: 40,
        y: HEIGHT - groundHeight - 32,
        w: 24,
        h: 24,
        vx: 0,
        vy: 0,
        onGround: false,
        facing: 1,
        frame: 0,
        frameTimer: 0
      };

      var platforms = [];
      var enemies = [];

      // LEVEL DATA (Retro Hard)
      var levels = [
        {
          length: 1200,
          platforms: [
            { x: 0, y: HEIGHT - groundHeight, w: 1200, h: groundHeight },
            { x: 180, y: HEIGHT - 90, w: 100, h: 14 },
            { x: 360, y: HEIGHT - 140, w: 120, h: 14 },
            { x: 580, y: HEIGHT - 110, w: 100, h: 14 },
            { x: 760, y: HEIGHT - 160, w: 140, h: 14 }
          ],
          enemies: [
            { x: 220, y: HEIGHT - 90 - 20, vx: 60, platformIndex: 1 },
            { x: 380, y: HEIGHT - 140 - 20, vx: -70, platformIndex: 2 },
            { x: 620, y: HEIGHT - 110 - 20, vx: 60, platformIndex: 3 }
          ]
        },

        {
          length: 1500,
          platforms: [
            { x: 0, y: HEIGHT - groundHeight, w: 1500, h: groundHeight },
            { x: 200, y: HEIGHT - 80, w: 120, h: 14 },
            { x: 380, y: HEIGHT - 140, w: 140, h: 14 },
            { x: 620, y: HEIGHT - 100, w: 100, h: 14 },
            { x: 820, y: HEIGHT - 160, w: 140, h: 14 },
            { x: 1100, y: HEIGHT - 130, w: 120, h: 14 }
          ],
          enemies: [
            { x: 250, y: HEIGHT - 80 - 20, vx: 70, platformIndex: 1 },
            { x: 400, y: HEIGHT - 140 - 20, vx: -80, platformIndex: 2 },
            { x: 900, y: HEIGHT - 160 - 20, vx: 90, platformIndex: 4 },
            { x: 1140, y: HEIGHT - 130 - 20, vx: -70, platformIndex: 5 }
          ]
        },

        {
          length: 1800,
          platforms: [
            { x: 0, y: HEIGHT - groundHeight, w: 1800, h: groundHeight },
            { x: 180, y: HEIGHT - 90, w: 100, h: 14 },
            { x: 360, y: HEIGHT - 140, w: 120, h: 14 },
            { x: 580, y: HEIGHT - 110, w: 100, h: 14 },
            { x: 760, y: HEIGHT - 160, w: 140, h: 14 },
            { x: 1000, y: HEIGHT - 130, w: 120, h: 14 },
            { x: 1300, y: HEIGHT - 150, w: 140, h: 14 }
          ],
          enemies: [
            { x: 220, y: HEIGHT - 90 - 20, vx: 80, platformIndex: 1 },
            { x: 380, y: HEIGHT - 140 - 20, vx: -90, platformIndex: 2 },
            { x: 620, y: HEIGHT - 110 - 20, vx: 80, platformIndex: 3 },
            { x: 780, y: HEIGHT - 160 - 20, vx: -100, platformIndex: 4 },
            { x: 1040, y: HEIGHT - 130 - 20, vx: 90, platformIndex: 5 },
            { x: 1340, y: HEIGHT - 150 - 20, vx: -110, platformIndex: 6 }
          ]
        }
      ];

      var currentLevel = 0;

      function loadLevel(index) {
        var lvl = levels[index];

        platforms = [];
        enemies = [];

        lvl.platforms.forEach(p => {
          platforms.push({
            x: p.x,
            y: p.y,
            w: p.w,
            h: p.h
          });
        });

        lvl.enemies.forEach(e => {
          enemies.push({
            x: e.x,
            y: e.y,
            w: 20,
            h: 20,
            vx: e.vx,
            alive: true,
            platformIndex: e.platformIndex
          });
        });
      }

      function createLevel() {
        loadLevel(currentLevel);
      }

      function resetGame() {
        createLevel();

        player.x = 40;
        player.y = HEIGHT - groundHeight - player.h;
        player.vx = 0;
        player.vy = 0;
        player.onGround = false;
        player.facing = 1;
        player.frame = 0;
        player.frameTimer = 0;

        cameraX = 0;
        running = false;
        gameOver = false;
        lastTime = 0;
        score = 0;

        scoreEl.textContent = "0";
        livesEl.textContent = lives.toString();
        statusEl.textContent = "Press A / D / Space / ↑ to start.";
      }

      function rectsIntersect(a, b) {
        return (
          a.x < b.x + b.w &&
          a.x + a.w > b.x &&
          a.y < b.y + b.h &&
          a.y + a.h > b.y
        );
      }

      function applyHorizontalCollision(entity, plat) {
        if (!rectsIntersect(entity, plat)) return;

        if (entity.vx > 0) {
          entity.x = plat.x - entity.w;
        } else if (entity.vx < 0) {
          entity.x = plat.x + plat.w;
        }
        entity.vx = 0;
      }

      function applyVerticalCollision(entity, plat) {
        if (!rectsIntersect(entity, plat)) return;

        if (entity.vy > 0) {
          entity.y = plat.y - entity.h;
          entity.vy = 0;
          entity.onGround = true;
        } else if (entity.vy < 0) {
          entity.y = plat.y + plat.h;
          entity.vy = 0;
        }
      }

      function update(dt) {
        if (!running) return;

        var targetVX = 0;
        if (keys.left) targetVX -= MOVE_SPEED;
        if (keys.right) targetVX += MOVE_SPEED;

        player.vx = targetVX;
        if (targetVX !== 0) {
          player.facing = targetVX > 0 ? 1 : -1;
        }

        if (keys.jump && player.onGround) {
          player.vy = -JUMP_FORCE;
          player.onGround = false;
        }

        player.vy += GRAVITY * dt;

        player.x += player.vx * dt;
        player.onGround = false;

        for (var i = 0; i < platforms.length; i++) {
          applyHorizontalCollision(player, platforms[i]);
        }

        player.y += player.vy * dt;

        for (var j = 0; j < platforms.length; j++) {
          applyVerticalCollision(player, platforms[j]);
        }

        if (player.onGround && Math.abs(player.vx) > 10) {
          player.frameTimer += dt;
          if (player.frameTimer > 0.12) {
            player.frameTimer = 0;
            player.frame = (player.frame + 1) % 2;
          }
        } else {
          player.frame = 0;
          player.frameTimer = 0;
        }

        var levelEnd = levels[currentLevel].length - 150;
        cameraX = player.x - 120;
        if (cameraX < 0) cameraX = 0;
        if (cameraX > levelEnd) cameraX = levelEnd;

        enemies.forEach(function (e) {
          if (!e.alive) return;

          e.x += e.vx * dt;

          var plat = platforms[e.platformIndex];
          if (plat) {
            if (e.x < plat.x) {
              e.x = plat.x;
              e.vx = Math.abs(e.vx);
            } else if (e.x + e.w > plat.x + plat.w) {
              e.x = plat.x + plat.w - e.w;
              e.vx = -Math.abs(e.vx);
            }
          }

          var pRect = { x: player.x, y: player.y, w: player.w, h: player.h };
          var eRect = { x: e.x, y: e.y, w: e.w, h: e.h };

          if (rectsIntersect(pRect, eRect)) {
            var playerFeet = player.y + player.h;
            var enemyTop = e.y + 4;

            if (player.vy > 0 && playerFeet <= enemyTop) {
              e.alive = false;
              player.vy = -JUMP_FORCE * 0.6;
              score += 100;
              scoreEl.textContent = score.toString();
            } else {
              loseLife();
            }
          }
        });

        score += dt * 20;
        scoreEl.textContent = Math.floor(score).toString();

        if (player.y > HEIGHT + 50) {
          loseLife();
        }

        if (player.x > levelEnd) {
          nextLevel();
        }
      }

      function loseLife() {
        lives--;
        livesEl.textContent = lives.toString();

        if (lives <= 0) {
          handleGameOver();
          return;
        }

        statusEl.textContent = "Ouch! You lost a life. Restarting level...";
        running = false;

        setTimeout(() => {
          resetGame();
          running = true;
          statusEl.textContent = "";
        }, 1200);
      }

      function nextLevel() {
        currentLevel++;

        if (currentLevel >= levels.length) {
          statusEl.textContent = "You beat all levels! Sanic approves.";
          running = false;
          gameOver = true;
          return;
        }

        statusEl.textContent = "Level Complete! Loading next...";
        running = false;

        setTimeout(() => {
          resetGame();
          running = true;
          statusEl.textContent = "";
        }, 1200);
      }

      function handleGameOver() {
        if (gameOver) return;
        gameOver = true;
        running = false;
        statusEl.textContent =
          "Game Over! Final score: " + Math.floor(score) + ". Press Restart or any key.";
      }

      function drawBackground() {
        ctx.fillStyle = "#1d4ed8";
        ctx.fillRect(0, 0, WIDTH, HEIGHT);

        ctx.fillStyle = "#93c5fd";
        for (var i = 0; i < 3; i++) {
          var cx = ((i * 160 - cameraX * 0.4) % (WIDTH + 160)) - 80;
          var cy = 60 + (i % 2) * 20;
          ctx.beginPath();
          ctx.arc(cx, cy, 26, 0, Math.PI * 2);
          ctx.arc(cx + 18, cy + 6, 20, 0, Math.PI * 2);
          ctx.arc(cx - 18, cy + 6, 20, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      function drawPlatforms() {
        platforms.forEach(function (p) {
          var sx = Math.round(p.x - cameraX);
          var sy = Math.round(p.y);

          if (sy >= HEIGHT || sx + p.w < -50 || sx > WIDTH + 50) return;

          if (p.h >= groundHeight - 1) {
            ctx.fillStyle = "#16a34a";
            ctx.fillRect(sx, sy, p.w, p.h);
            ctx.fillStyle = "#14532d";
            ctx.fillRect(sx, sy + 10, p.w, p.h - 10);

            ctx.fillStyle = "#22c55e";
            for (var x = sx; x < sx + p.w; x += 12) {
              ctx.fillRect(x, sy - 3, 4, 3);
            }
          } else {
            ctx.fillStyle = "#16a34a";
            ctx.fillRect(sx, sy, p.w, p.h);
            ctx.fillStyle = "#14532d";
            ctx.fillRect(sx, sy + p.h - 3, p.w, 3);
          }
        });
