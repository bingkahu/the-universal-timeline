<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Sanic the Porcupine – Platformer</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #020617;
      color: #e5e7eb;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }

    .wrapper {
      text-align: center;
    }

    h1 {
      margin-bottom: 6px;
      font-size: 22px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    p {
      margin-bottom: 8px;
      font-size: 13px;
      color: #9ca3af;
    }

    #game {
      border: 4px solid #111827;
      border-radius: 6px;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      background: #1d4ed8;
      box-shadow: 0 0 24px rgba(15, 23, 42, 0.8);
      display: block;
      margin: 0 auto;
    }

    #hud {
      margin-top: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 13px;
      color: #9ca3af;
      max-width: 512px;
    }

    #score {
      font-weight: 600;
      color: #e5e7eb;
    }

    #status {
      min-height: 18px;
      margin-top: 4px;
      font-size: 12px;
      color: #fbbf24;
    }

    .btn {
      border: none;
      background: #4f46e5;
      color: #e5e7eb;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      cursor: pointer;
      box-shadow: 0 0 10px rgba(79, 70, 229, 0.7);
      transition: background 0.15s ease, transform 0.1s ease;
    }

    .btn:hover {
      background: #6366f1;
      transform: translateY(-1px);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 0 4px rgba(79, 70, 229, 0.7);
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Sanic the Porcupine</h1>
    <p>Move with <strong>A / D</strong>, jump with <strong>Space</strong> or <strong>↑</strong>. Stomp enemies, avoid touching them from the side.</p>

    <canvas id="game" width="512" height="288"></canvas>

    <div id="hud">
      <div>Score: <span id="score">0</span></div>
      <button id="restart" class="btn">Restart</button>
    </div>
    <div id="status">Press any movement key or jump to start.</div>
  </div>

  <script>
    (function () {
      "use strict";

      var canvas = document.getElementById("game");
      var ctx = canvas.getContext("2d");

      var scoreEl = document.getElementById("score");
      var restartBtn = document.getElementById("restart");
      var statusEl = document.getElementById("status");

      var WIDTH = canvas.width;
      var HEIGHT = canvas.height;

      function pix(n) {
        return Math.round(n);
      }

      var GRAVITY = 900;
      var MOVE_SPEED = 220;
      var JUMP_FORCE = 400;

      var groundHeight = 40;

      var keys = {
        left: false,
        right: false,
        jump: false
      };

      var running = false;
      var gameOver = false;
      var lastTime = 0;
      var score = 0;

      var cameraX = 0;

      var player = {
        x: 40,
        y: HEIGHT - groundHeight - 32,
        w: 24,
        h: 24,
        vx: 0,
        vy: 0,
        onGround: false,
        facing: 1,
        frame: 0,
        frameTimer: 0
      };

      var platforms = [];
      var enemies = [];

      function createLevel() {
        platforms = [];
        enemies = [];

        var groundY = HEIGHT - groundHeight;

        platforms.push({
          x: 0,
          y: groundY,
          w: 800,
          h: groundHeight
        });

        platforms.push({ x: 140, y: groundY - 60, w: 90, h: 14 });
        platforms.push({ x: 280, y: groundY - 110, w: 110, h: 14 });
        platforms.push({ x: 460, y: groundY - 80, w: 90, h: 14 });

        platforms.push({ x: 620, y: groundY - 50, w: 80, h: 14 });
        platforms.push({ x: 760, y: groundY - 90, w: 110, h: 14 });

        enemies.push({
          x: 210,
          y: groundY - 20,
          w: 20,
          h: 20,
          vx: -50,
          alive: true,
          platformIndex: 0
        });

        enemies.push({
          x: 310,
          y: groundY - 110 - 20,
          w: 20,
          h: 20,
          vx: 40,
          alive: true,
          platformIndex: 2
        });

        enemies.push({
          x: 780,
          y: groundY - 90 - 20,
          w: 20,
          h: 20,
          vx: -45,
          alive: true,
          platformIndex: 4
        });
      }

      function resetGame() {
        createLevel();

        player.x = 40;
        player.y = HEIGHT - groundHeight - player.h;
        player.vx = 0;
        player.vy = 0;
        player.onGround = false;
        player.facing = 1;
        player.frame = 0;
        player.frameTimer = 0;

        cameraX = 0;
        running = false;
        gameOver = false;
        lastTime = 0;
        score = 0;
        scoreEl.textContent = "0";
        statusEl.textContent = "Press A / D / Space / ↑ to start.";
      }

      function rectsIntersect(a, b) {
        return (
          a.x < b.x + b.w &&
          a.x + a.w > b.x &&
          a.y < b.y + b.h &&
          a.y + a.h > b.y
        );
      }

      function applyHorizontalCollision(entity, plat) {
        if (!rectsIntersect(entity, plat)) return;

        if (entity.vx > 0) {
          entity.x = plat.x - entity.w;
        } else if (entity.vx < 0) {
          entity.x = plat.x + plat.w;
        }
        entity.vx = 0;
      }

      function applyVerticalCollision(entity, plat) {
        if (!rectsIntersect(entity, plat)) return;

        var prevBottom = entity.y + entity.h - entity.vy * (1 / 60);
        var prevTop = entity.y - entity.vy * (1 / 60);

        if (entity.vy > 0) {
          entity.y = plat.y - entity.h;
          entity.vy = 0;
          entity.onGround = true;
        } else if (entity.vy < 0) {
          entity.y = plat.y + plat.h;
          entity.vy = 0;
        }
      }

      function update(dt) {
        if (!running) return;

        var targetVX = 0;
        if (keys.left) targetVX -= MOVE_SPEED;
        if (keys.right) targetVX += MOVE_SPEED;

        player.vx = targetVX;
        if (targetVX !== 0) {
          player.facing = targetVX > 0 ? 1 : -1;
        }

        if (keys.jump && player.onGround) {
          player.vy = -JUMP_FORCE;
          player.onGround = false;
        }

        player.vy += GRAVITY * dt;

        player.x += player.vx * dt;
        player.onGround = false;

        for (var i = 0; i < platforms.length; i++) {
          applyHorizontalCollision(player, platforms[i]);
        }

        player.y += player.vy * dt;

        for (var j = 0; j < platforms.length; j++) {
          applyVerticalCollision(player, platforms[j]);
        }

        if (player.onGround && Math.abs(player.vx) > 10) {
          player.frameTimer += dt;
          if (player.frameTimer > 0.12) {
            player.frameTimer = 0;
            player.frame = (player.frame + 1) % 2;
          }
        } else {
          player.frame = 0;
          player.frameTimer = 0;
        }

        var levelEnd = 800 - 150;
        cameraX = player.x - 120;
        if (cameraX < 0) cameraX = 0;
        if (cameraX > levelEnd) cameraX = levelEnd;

        enemies.forEach(function (e) {
          if (!e.alive) return;

          e.x += e.vx * dt;

          var plat = platforms[e.platformIndex];
          if (plat) {
            if (e.x < plat.x) {
              e.x = plat.x;
              e.vx = Math.abs(e.vx);
            } else if (e.x + e.w > plat.x + plat.w) {
              e.x = plat.x + plat.w - e.w;
              e.vx = -Math.abs(e.vx);
            }
          }

          var pRect = { x: player.x, y: player.y, w: player.w, h: player.h };
          var eRect = { x: e.x, y: e.y, w: e.w, h: e.h };

          if (rectsIntersect(pRect, eRect)) {
            var playerFeet = player.y + player.h;
            var enemyTop = e.y + 4;

            if (player.vy > 0 && playerFeet <= enemyTop) {
              e.alive = false;
              player.vy = -JUMP_FORCE * 0.6;
              score += 100;
              scoreEl.textContent = score.toString();
            } else {
              handleGameOver();
            }
          }
        });

        score += dt * 20;
        scoreEl.textContent = Math.floor(score).toString();

        if (player.y > HEIGHT + 50) {
          handleGameOver();
        }
      }

      function handleGameOver() {
        if (gameOver) return;
        gameOver = true;
        running = false;
        statusEl.textContent =
          "Game Over! Final score: " + Math.floor(score) + ". Press Restart or any key.";
      }

      function drawBackground() {
        ctx.fillStyle = "#1d4ed8";
        ctx.fillRect(0, 0, WIDTH, HEIGHT);

        ctx.fillStyle = "#93c5fd";
        for (var i = 0; i < 3; i++) {
          var cx = ((i * 160 - cameraX * 0.4) % (WIDTH + 160)) - 80;
          var cy = 60 + (i % 2) * 20;
          ctx.beginPath();
          ctx.arc(cx, cy, 26, 0, Math.PI * 2);
          ctx.arc(cx + 18, cy + 6, 20, 0, Math.PI * 2);
          ctx.arc(cx - 18, cy + 6, 20, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      function drawPlatforms() {
        platforms.forEach(function (p) {
          var sx = Math.round(p.x - cameraX);
          var sy = Math.round(p.y);

          if (sy >= HEIGHT || sx + p.w < -50 || sx > WIDTH + 50) return;

          if (p.h >= groundHeight - 1) {
            ctx.fillStyle = "#16a34a";
            ctx.fillRect(sx, sy, p.w, p.h);
            ctx.fillStyle = "#14532d";
            ctx.fillRect(sx, sy + 10, p.w, p.h - 10);

            ctx.fillStyle = "#22c55e";
            for (var x = sx; x < sx + p.w; x += 12) {
              ctx.fillRect(x, sy - 3, 4, 3);
            }
          } else {
            ctx.fillStyle = "#16a34a";
            ctx.fillRect(sx, sy, p.w, p.h);
            ctx.fillStyle = "#14532d";
            ctx.fillRect(sx, sy + p.h - 3, p.w, 3);
          }
        });
      }

      function drawSanic() {
        var x = Math.round(player.x - cameraX);
        var y = Math.round(player.y);
        var w = player.w;
        var h = player.h;

        ctx.save();
        ctx.translate(x + w / 2, y + h / 2);
        ctx.scale(player.facing, 1);
        ctx.translate(-w / 2, -h / 2);

        ctx.fillStyle = "#1d4ed8";
        ctx.fillRect(0, 4, w, 16);

        ctx.fillStyle = "#2563eb";
        ctx.fillRect(10, 0, 10, 10);

        ctx.fillStyle = "#fee2e2";
        ctx.fillRect(12, 2, 6, 6);

        ctx.fillStyle = "#000000";
        ctx.fillRect(16, 3, 2, 2);

        ctx.fillStyle = "#1d4ed8";
        ctx.fillRect(4, 2, 6, 3);
        ctx.fillRect(2, 6, 6, 3);

        ctx.fillStyle = "#f97316";
        if (player.onGround && Math.abs(player.vx) > 10) {
          if (player.frame === 0) {
            ctx.fillRect(4, 20, 6, 4);
            ctx.fillRect(14, 20, 6, 4);
          } else {
            ctx.fillRect(6, 20, 6, 4);
            ctx.fillRect(12, 20, 6, 4);
          }
        } else {
          ctx.fillRect(6, 20, 12, 4);
        }

        ctx.fillStyle = "#fbbf24";
        ctx.fillRect(2, 10, 4, 4);
        ctx.fillRect(18, 10, 4, 4);

        ctx.restore();
      }

      function drawEnemies() {
        enemies.forEach(function (e) {
          if (!e.alive) return;
          var x = Math.round(e.x - cameraX);
          var y = Math.round(e.y);
          var w = e.w;
          var h = e.h;

          if (x + w < -10 || x > WIDTH + 10) return;

          ctx.fillStyle = "#dc2626";
          ctx.fillRect(x, y + 4, w, h - 4);

          ctx.fillStyle = "#fecaca";
          ctx.fillRect(x + 4, y + 2, w - 8, 6);

          ctx.fillStyle = "#000000";
          ctx.fillRect(x + 6, y + 4, 2, 2);
          ctx.fillRect(x + w - 8, y + 4, 2, 2);

          ctx.fillStyle = "#4b5563";
          ctx.fillRect(x, y + h - 4, w, 4);
        });
      }

      function draw() {
        drawBackground();
        drawPlatforms();
        drawEnemies();
        drawSanic();
      }

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;
        var dt = (timestamp - lastTime) / 1000;
        if (dt > 0.03) dt = 0.03;
        lastTime = timestamp;

        if (!gameOver && running) {
          update(dt);
        }

        draw();
        requestAnimationFrame(loop);
      }

      function handleKeyDown(e) {
        if (e.code === "KeyA" || e.key === "a" || e.key === "A") {
          keys.left = true;
        }
        if (e.code === "KeyD" || e.key === "d" || e.key === "D") {
          keys.right = true;
        }
        if (
          e.code === "Space" ||
          e.code === "ArrowUp" ||
          e.key === " " ||
          e.key === "ArrowUp"
        ) {
          keys.jump = true;
        }

        if (!running && !gameOver) {
          running = true;
          statusEl.textContent = "";
        } else if (gameOver) {
          resetGame();
        }
      }

      function handleKeyUp(e) {
        if (e.code === "KeyA" || e.key === "a" || e.key === "A") {
          keys.left = false;
        }
        if (e.code === "KeyD" || e.key === "d" || e.key === "D") {
          keys.right = false;
        }
        if (
          e.code === "Space" ||
          e.code === "ArrowUp" ||
          e.key === " " ||
          e.key === "ArrowUp"
        ) {
          keys.jump = false;
        }
      }

      window.addEventListener("keydown", handleKeyDown);
      window.addEventListener("keyup", handleKeyUp);

      restartBtn.addEventListener("click", function () {
        resetGame();
      });

      resetGame();
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
