<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NEURAL NEXUS: P2P COMMS</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --blue: #007AFF; --dark: #121212; --msg-in: #26262b; }
        body { margin: 0; background: #000; font-family: sans-serif; color: white; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        
        /* Sanic background layer */
        #bg { position: fixed; top:0; left:0; width:100%; height:100%; z-index: 1; opacity: 0.2; pointer-events: none; }

        #setup-overlay {
            position: fixed; z-index: 100; top:0; left:0; width:100%; height:100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column; align-items: center; justify-content: center;
        }

        #chat-ui { position: relative; z-index: 10; display: flex; flex-direction: column; height: 100%; max-width: 500px; margin: 0 auto; width: 100%; background: var(--dark); }
        #logs { flex-grow: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 10px; }
        
        .bubble { max-width: 80%; padding: 10px 15px; border-radius: 18px; font-size: 15px; line-height: 1.4; }
        .sent { align-self: flex-end; background: var(--blue); border-bottom-right-radius: 4px; }
        .recv { align-self: flex-start; background: var(--msg-in); border-bottom-left-radius: 4px; }

        #input-bar { padding: 15px; display: flex; gap: 10px; border-top: 1px solid #333; }
        input { flex-grow: 1; background: #333; border: none; border-radius: 20px; padding: 10px 15px; color: white; outline: none; }
        button { background: var(--blue); border: none; color: white; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; }
    </style>
</head>
<body>

<canvas id="bg"></canvas>

<div id="setup-overlay">
    <h2 style="color:var(--blue)">NEURAL LINK</h2>
    <p>Your ID: <span id="my-id" style="color:yellow">...</span></p>
    <input type="text" id="peer-id-input" placeholder="Enter Friend's ID" style="width: 250px; margin-bottom: 10px;">
    <button id="connect-btn" style="border-radius: 5px; width: 200px; height: 40px;">CONNECT DIMENSIONS</button>
</div>

<div id="chat-ui">
    <div style="padding: 10px; text-align: center; border-bottom: 1px solid #333; font-size: 12px;">ENCRYPTED P2P LINE</div>
    <div id="logs"></div>
    <div id="input-bar">
        <input type="text" id="msg-input" placeholder="Message">
        <button id="send-btn">â†‘</button>
    </div>
</div>

<script>
    // --- PEER LOGIC ---
    const peer = new Peer(); 
    let conn;

    peer.on('open', (id) => {
        document.getElementById('my-id').innerText = id;
    });

    // Handle incoming connections
    peer.on('connection', (c) => {
        conn = c;
        setupChat();
        document.getElementById('setup-overlay').style.display = 'none';
    });

    document.getElementById('connect-btn').onclick = () => {
        const remoteId = document.getElementById('peer-id-input').value;
        conn = peer.connect(remoteId);
        setupChat();
        document.getElementById('setup-overlay').style.display = 'none';
    };

    function setupChat() {
        conn.on('data', (data) => {
            addBubble(data, 'recv');
        });
    }

    // --- UI LOGIC ---
    const logs = document.getElementById('logs');
    const input = document.getElementById('msg-input');

    function addBubble(text, type) {
        const b = document.createElement('div');
        b.className = `bubble ${type}`;
        b.innerText = text;
        logs.appendChild(b);
        logs.scrollTop = logs.scrollHeight;
    }

    function send() {
        const val = input.value;
        if(!val || !conn) return;
        conn.send(val);
        addBubble(val, 'sent');
        input.value = "";
    }

    document.getElementById('send-btn').onclick = send;
    input.onkeypress = (e) => { if(e.key === 'Enter') send(); };

    // --- SANIC BG ENGINE ---
    const canvas = document.getElementById('bg');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    let s = { x: 50, y: 50, vx: 4, vy: 4 };
    function loop() {
        ctx.fillStyle = "black"; ctx.fillRect(0,0,canvas.width,canvas.height);
        s.x += s.vx; s.y += s.vy;
        if(s.x > canvas.width || s.x < 0) s.vx *= -1;
        if(s.y > canvas.height || s.y < 0) s.vy *= -1;
        ctx.fillStyle = "#0044ff"; ctx.beginPath(); ctx.arc(s.x, s.y, 20, 0, Math.PI*2); ctx.fill();
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
