<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pixel Dodger</title>
  <style>
    :root {
      --bg: #0f1226;
      --panel: #1b1f3b;
      --accent: #6cf1ff;
      --danger: #ff4d6d;
      --safe: #7cff7c;
      --text: #e9ecff;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: radial-gradient(1200px at 50% 20%, #14173a, var(--bg));
      color: var(--text);
      display: grid;
      place-items: center;
      min-height: 100vh;
    }

    .wrap {
      width: 900px;
      max-width: 92vw;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .brand {
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .hud {
      display: flex;
      gap: 12px;
      align-items: center;
      background: linear-gradient(180deg, #22264d, var(--panel));
      border: 1px solid #2b3163;
      border-radius: 10px;
      padding: 8px 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.35);
    }

    .hud .pill {
      background: #0f1433;
      border: 1px solid #2b3163;
      padding: 6px 10px;
      border-radius: 8px;
      min-width: 90px;
      text-align: center;
    }

    .btn {
      background: var(--accent);
      color: #041018;
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-weight: 700;
      cursor: pointer;
      transition: transform 0.08s ease, filter 0.2s ease;
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: scale(0.98); }

    /* Game area */
    #game {
      position: relative;
      width: 900px;
      max-width: 92vw;
      height: 520px;
      border-radius: 14px;
      overflow: hidden;
      background:
        radial-gradient(800px at 20% 10%, #1a1f47 0%, #0f1226 60%),
        repeating-linear-gradient(180deg, rgba(255,255,255,0.04) 0 2px, transparent 2px 6px);
      border: 1px solid #2b3163;
      box-shadow: 0 12px 40px rgba(0,0,0,0.45);
    }

    /* Player */
    .player {
      position: absolute;
      width: 36px;
      height: 36px;
      border-radius: 6px;
      background: linear-gradient(135deg, var(--accent), #3bd6ff);
      box-shadow: 0 0 18px rgba(108,241,255,0.6);
      outline: 2px solid rgba(108,241,255,0.35);
    }

    /* Obstacles */
    .ob {
      position: absolute;
      width: 34px;
      height: 34px;
      border-radius: 6px;
      background: linear-gradient(135deg, #ff6b8a, var(--danger));
      box-shadow: 0 0 16px rgba(255,77,109,0.5);
      outline: 2px solid rgba(255,77,109,0.35);
    }

    /* Collectibles */
    .gem {
      position: absolute;
      width: 26px;
      height: 26px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #baffc1 20%, var(--safe) 60%);
      box-shadow: 0 0 14px rgba(124,255,124,0.6);
      outline: 2px solid rgba(124,255,124,0.35);
    }

    /* Overlay */
    .overlay {
      position: absolute;
      inset: 0;
      display: grid;
      place-items: center;
      background: rgba(10, 12, 26, 0.6);
      backdrop-filter: blur(2px);
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s ease;
    }
    .overlay.show {
      opacity: 1;
      pointer-events: auto;
    }
    .panel {
      background: linear-gradient(180deg, #22264d, var(--panel));
      border: 1px solid #2b3163;
      border-radius: 12px;
      padding: 18px;
      width: 420px;
      max-width: 86vw;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .panel h2 { margin: 0 0 8px; }
    .panel p { margin: 6px 0 14px; color: #cfd6ff; }
    .panel .kbd {
      display: inline-block;
      border: 1px solid #2b3163;
      border-radius: 6px;
      padding: 2px 6px;
      margin: 0 2px;
      background: #0f1433;
      color: #cfd6ff;
      font-weight: 700;
    }

    footer {
      margin-top: 10px;
      font-size: 12px;
      color: #9aa3d9;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">üéÆ Pixel Dodger</div>
      <div class="hud">
        <div class="pill"><strong>Score:</strong> <span id="score">0</span></div>
        <div class="pill"><strong>Best:</strong> <span id="best">0</span></div>
        <div class="pill"><strong>Level:</strong> <span id="level">1</span></div>
        <button id="startBtn" class="btn">Start</button>
      </div>
    </header>

    <div id="game">
      <div id="player" class="player"></div>

      <div id="overlay" class="overlay show">
        <div class="panel">
          <h2>Welcome to Pixel Dodger</h2>
          <p>Move with <span class="kbd">‚Üê</span> <span class="kbd">‚Üí</span> and dodge red blocks. Collect green orbs for bonus points.</p>
          <p>Survive as long as you can‚Äîspeed increases every level.</p>
          <button id="playBtn" class="btn">Play</button>
        </div>
      </div>
    </div>

    <footer>Built with HTML, CSS, and vanilla JS‚Äîsingle file, instantly deployable.</footer>
  </div>

  <script>
    // --- Game config ---
    const gameEl = document.getElementById('game');
    const playerEl = document.getElementById('player');
    const overlayEl = document.getElementById('overlay');
    const scoreEl = document.getElementById('score');
    const bestEl = document.getElementById('best');
    const levelEl = document.getElementById('level');
    const startBtn = document.getElementById('startBtn');
    const playBtn = document.getElementById('playBtn');

    const state = {
      running: false,
      score: 0,
      best: Number(localStorage.getItem('pixelDodgerBest') || 0),
      level: 1,
      speed: 2.2,          // base obstacle fall speed
      spawnEveryMs: 700,   // obstacle spawn interval
      gemChance: 0.22,     // chance to spawn a gem instead of obstacle
      playerX: 0,
      playerY: 0,
      keys: { left: false, right: false },
      entities: []         // {el, x, y, vy, type:'ob'|'gem'}
    };
    bestEl.textContent = state.best;

    // --- Sizing ---
    function bounds() {
      const r = gameEl.getBoundingClientRect();
      return { w: r.width, h: r.height };
    }

    function placePlayer(centerX) {
      const { w, h } = bounds();
      const size = 36;
      state.playerX = Math.max(0, Math.min(w - size, centerX - size / 2));
      state.playerY = h - size - 16;
      playerEl.style.transform = `translate(${state.playerX}px, ${state.playerY}px)`;
    }

    // --- Controls ---
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') state.keys.left = true;
      if (e.key === 'ArrowRight') state.keys.right = true;
    });
    window.addEventListener('keyup', (e) => {
      if (e.key === 'ArrowLeft') state.keys.left = false;
      if (e.key === 'ArrowRight') state.keys.right = false;
    });

    gameEl.addEventListener('mousemove', (e) => {
      if (!state.running) return;
      const rect = gameEl.getBoundingClientRect();
      placePlayer(e.clientX - rect.left);
    });

    // --- Entity helpers ---
    function spawnEntity() {
      const { w } = bounds();
      const x = Math.random() * (w - 40);
      const type = Math.random() < state.gemChance ? 'gem' : 'ob';
      const el = document.createElement('div');
      el.className = type;
      gameEl.appendChild(el);
      const ent = { el, x, y: -40, vy: state.speed + Math.random() * 1.6, type };
      state.entities.push(ent);
      el.style.transform = `translate(${x}px, ${ent.y}px)`;
    }

    function removeEntity(ent) {
      ent.el.remove();
      const i = state.entities.indexOf(ent);
      if (i >= 0) state.entities.splice(i, 1);
    }

    // --- Collision ---
    function rectsOverlap(ax, ay, aw, ah, bx, by, bw, bh) {
      return ax < bx + bw && ax + aw > bx && ay < by + bh && ay + ah > by;
    }

    // --- Game loop ---
    let lastTime = 0;
    let spawnTimer = 0;

    function loop(ts) {
      if (!state.running) return;
      const dt = Math.min(32, ts - lastTime || 16);
      lastTime = ts;
      spawnTimer += dt;

      // Player movement via keys
      const speed = 0.45 * dt * (1 + (state.level - 1) * 0.08);
      if (state.keys.left) state.playerX -= speed;
      if (state.keys.right) state.playerX += speed;

      const { w, h } = bounds();
      const pSize = 36;
      state.playerX = Math.max(0, Math.min(w - pSize, state.playerX));
      playerEl.style.transform = `translate(${state.playerX}px, ${state.playerY}px)`;

      // Spawn entities
      if (spawnTimer >= state.spawnEveryMs) {
        spawnTimer = 0;
        spawnEntity();
      }

      // Update entities
      for (const ent of [...state.entities]) {
        ent.y += ent.vy;
        ent.el.style.transform = `translate(${ent.x}px, ${ent.y}px)`;

        // Collision with player
        const eSize = ent.type === 'ob' ? 34 : 26;
        if (rectsOverlap(state.playerX, state.playerY, pSize, pSize, ent.x, ent.y, eSize, eSize)) {
          if (ent.type === 'ob') {
            endGame();
            return;
          } else {
            // Collect gem
            state.score += 5;
            scoreEl.textContent = state.score;
            removeEntity(ent);
            // Small visual pop
            ent.el.style.scale = '1.2';
          }
        }

        // Remove off-screen
        if (ent.y > h + 60) removeEntity(ent);
      }

      // Passive scoring & difficulty ramp
      state.score += 1;
      scoreEl.textContent = state.score;

      const nextLevelAt = state.level * 250;
      if (state.score >= nextLevelAt) {
        state.level += 1;
        levelEl.textContent = state.level;
        state.speed += 0.25;
        state.spawnEveryMs = Math.max(380, state.spawnEveryMs - 30);
      }

      requestAnimationFrame(loop);
    }

    // --- Lifecycle ---
    function startGame() {
      // Reset
      state.running = true;
      state.score = 0;
      state.level = 1;
      state.speed = 2.2;
      state.spawnEveryMs = 700;
      scoreEl.textContent = 0;
      levelEl.textContent = 1;

      // Clear entities
      for (const ent of [...state.entities]) removeEntity(ent);

      // Place player center-bottom
      const { w } = bounds();
      placePlayer(w / 2);

      overlayEl.classList.remove('show');
      lastTime = performance.now();
      spawnTimer = 0;
      requestAnimationFrame(loop);
    }

    function endGame() {
      state.running = false;
      // Update best
      if (state.score > state.best) {
        state.best = state.score;
        localStorage.setItem('pixelDodgerBest', String(state.best));
        bestEl.textContent = state.best;
      }

      // Show overlay
      overlayEl.innerHTML = `
        <div class="panel">
          <h2>Game Over</h2>
          <p>Your score: <strong>${state.score}</strong> ‚Ä¢ Best: <strong>${state.best}</strong></p>
          <p>Tip: collect green orbs and keep moving‚Äîdon‚Äôt get cornered.</p>
          <button id="retryBtn" class="btn">Retry</button>
        </div>
      `;
      overlayEl.classList.add('show');
      document.getElementById('retryBtn').addEventListener('click', startGame);
    }

    // --- Buttons ---
    startBtn.addEventListener('click', () => {
      if (!state.running) startGame();
    });
    playBtn.addEventListener('click', startGame);

    // Initial placement
    window.addEventListener('resize', () => {
      const { w } = bounds();
      placePlayer(w / 2);
    });
    placePlayer(bounds().w / 2);
  </script>
</body>
</html>
